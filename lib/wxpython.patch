From 9dc9813a8d49817a36bd0d11ff57417c469102aa Mon Sep 17 00:00:00 2001
From: Weijia Wang <9713184+wegank@users.noreply.github.com>
Date: Wed, 10 Jul 2024 17:54:31 +0200
Subject: [PATCH] python312Packages.wxpython: fix build

---
 .../development/python-modules/wxpython/4.2.nix | 17 ++++++++++++++++-
 1 file changed, 16 insertions(+), 1 deletion(-)

diff --git a/pkgs/development/python-modules/wxpython/4.2.nix b/pkgs/development/python-modules/wxpython/4.2.nix
index 1ead7d38d20b81..e90098a484b283 100644
--- a/pkgs/development/python-modules/wxpython/4.2.nix
+++ b/pkgs/development/python-modules/wxpython/4.2.nix
@@ -5,6 +5,7 @@
   setuptools,
   pythonAtLeast,
   fetchPypi,
+  fetchurl,
   substituteAll,

   # build
@@ -40,11 +41,16 @@
   six,
 }:

+let
+  waf_2_0_25 = fetchurl {
+    url = "https://waf.io/waf-2.0.25";
+    hash = "sha256-IRmc0iDM9gQ0Ez4f0quMjlIXw3mRmcgnIlQ5cNyOONU=";
+  };
+in
 buildPythonPackage rec {
   pname = "wxpython";
   version = "4.2.1";
   format = "other";
-  disabled = pythonAtLeast "3.12";

   src = fetchPypi {
     pname = "wxPython";
@@ -61,6 +67,15 @@ buildPythonPackage rec {
     })
   ];

+  postPatch = ''
+    cp ${waf_2_0_25} bin/waf-2.0.25
+    chmod +x bin/waf-2.0.25
+    substituteInPlace build.py \
+      --replace-fail "wafCurrentVersion = '2.0.24'" "wafCurrentVersion = '2.0.25'" \
+      --replace-fail "wafMD5 = '698f382cca34a08323670f34830325c4'" "wafMD5 = 'a4b1c34a03d594e5744f9e42f80d969d'" \
+      --replace-fail "distutils.dep_util" "setuptools.modified"
+  '';
+
   nativeBuildInputs = [
     attrdict
     pkg-config